---
phase: 02-curriculum-generation
plan: 05
type: execute
wave: 3
depends_on: ["02-01", "02-04"]
files_modified:
  - src/app/(dashboard)/courses/[courseId]/page.tsx
  - src/app/(dashboard)/courses/[courseId]/layout.tsx
  - src/components/curriculum/curriculum-toc.tsx
  - src/components/curriculum/level-card.tsx
  - src/components/curriculum/chapter-list.tsx
autonomous: true

must_haves:
  truths:
    - "Uzytkownik widzi pelna strukture curriculum (spis tresci)"
    - "Kazdy poziom wyswietla learning outcomes"
    - "Nawigacja miedzy poziomami i rozdzialami dziala plynnie"
    - "Uzytkownik widzi swoj aktualny poziom i rozdzial"
  artifacts:
    - path: "src/app/(dashboard)/courses/[courseId]/page.tsx"
      provides: "Course detail page with TOC"
      min_lines: 40
    - path: "src/components/curriculum/curriculum-toc.tsx"
      provides: "Table of contents component"
      contains: "levels.map"
    - path: "src/components/curriculum/level-card.tsx"
      provides: "Level card with outcomes"
      contains: "learningOutcomes"
    - path: "src/components/curriculum/chapter-list.tsx"
      provides: "Chapter list within level"
      contains: "chapters.map"
  key_links:
    - from: "src/app/(dashboard)/courses/[courseId]/page.tsx"
      to: "src/lib/dal/courses.ts"
      via: "getCourse import"
      pattern: "getCourse"
    - from: "src/components/curriculum/curriculum-toc.tsx"
      to: "src/components/curriculum/level-card.tsx"
      via: "component import"
      pattern: "LevelCard"
---

<objective>
Curriculum TOC view - spis tresci kursu z nawigacja.

Purpose: Uzytkownik po utworzeniu kursu widzi pelna strukture programu nauczania. Moze przegladac poziomy, learning outcomes i rozdzialy. Nawigacja pozwala przeskakiwac miedzy sekcjami.
Output: Strona /courses/[courseId] z Table of Contents, level cards i chapter lists.
</objective>

<execution_context>
@C:\Users\dariu\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dariu\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-curriculum-generation/02-RESEARCH.md
@.planning/phases/02-curriculum-generation/02-01-SUMMARY.md
@.planning/phases/02-curriculum-generation/02-04-SUMMARY.md
@src/lib/dal/courses.ts
@src/lib/dal/progress.ts
@src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Course page i layout</name>
  <files>
    src/app/(dashboard)/courses/[courseId]/page.tsx
    src/app/(dashboard)/courses/[courseId]/layout.tsx
  </files>
  <action>
1. Utworz `src/app/(dashboard)/courses/[courseId]/layout.tsx`:
   - Server component
   - Fetch course data z getCourse(courseId)
   - Fetch progress z getProgress(userId, courseId)
   - Jesli kurs nie istnieje -> notFound()
   - Jesli kurs nie nalezy do usera (RLS powinno chronic, ale double-check) -> notFound()
   - Przekaz course i progress do children przez context lub props

2. Utworz `src/app/(dashboard)/courses/[courseId]/page.tsx`:
   - Server component
   - Wyswietl:
     a) Header z tytulem kursu i opisem
     b) Meta info: szacowany czas, prerequisites
     c) Aktualny postep (z progress) - procent ukonczenia
     d) CurriculumTOC component z pelna struktura
   - Link do pierwszego nieukonczonego rozdzialu: "Kontynuuj nauke"
   - Struktura:
     ```tsx
     <div className="container max-w-4xl py-8">
       <header className="mb-8">
         <h1 className="text-3xl font-bold">{course.title}</h1>
         <p className="text-muted-foreground mt-2">{course.description}</p>
         <div className="flex gap-4 mt-4 text-sm">
           <span>~{course.totalEstimatedHours}h calkowicie</span>
           <span>{progress.percentage}% ukonczone</span>
         </div>
       </header>

       <Button asChild className="mb-8">
         <Link href={`/courses/${courseId}/${currentLevelId}/${currentChapterId}`}>
           Kontynuuj nauke
         </Link>
       </Button>

       <CurriculumTOC
         levels={course.levels}
         progress={progress}
         courseId={courseId}
       />
     </div>
     ```
  </action>
  <verify>
- `npm run build` - brak bledow
- `grep "getCourse" src/app/(dashboard)/courses/[courseId]/page.tsx` - pobiera kurs
- `grep "notFound" src/app/(dashboard)/courses/[courseId]/layout.tsx` - obsluguje 404
  </verify>
  <done>
Layout z data fetching dla course i progress.
Page z headerem, meta info, progress summary.
Link "Kontynuuj nauke" do aktualnego rozdzialu.
  </done>
</task>

<task type="auto">
  <name>Task 2: TOC components - LevelCard i ChapterList</name>
  <files>
    src/components/curriculum/curriculum-toc.tsx
    src/components/curriculum/level-card.tsx
    src/components/curriculum/chapter-list.tsx
  </files>
  <action>
1. Zainstaluj Collapsible jesli brak:
   ```bash
   npx shadcn@latest add collapsible
   ```

2. Utworz `src/components/curriculum/level-card.tsx`:
   - Client component (dla interaktywnosci collapsible)
   - Props: level, isExpanded, onToggle, progress, courseId, levelIndex
   - Struktura:
     ```tsx
     <Card className={cn(
       "mb-4",
       isCompleted && "border-green-500/50",
       isCurrent && "border-primary"
     )}>
       <Collapsible open={isExpanded} onOpenChange={onToggle}>
         <CollapsibleTrigger asChild>
           <CardHeader className="cursor-pointer hover:bg-muted/50">
             <div className="flex justify-between items-center">
               <div>
                 <Badge variant={levelIndex === 0 ? "default" : "secondary"}>
                   Poziom {levelIndex + 1}
                 </Badge>
                 <CardTitle className="mt-2">{level.name}</CardTitle>
                 <p className="text-sm text-muted-foreground">{level.description}</p>
               </div>
               <div className="text-right">
                 <span className="text-sm">{level.estimatedHours}h</span>
                 <ChevronDown className={cn("h-5 w-5 transition-transform", isExpanded && "rotate-180")} />
               </div>
             </div>
           </CardHeader>
         </CollapsibleTrigger>

         <CollapsibleContent>
           <CardContent>
             {/* Learning Outcomes */}
             <div className="mb-4">
               <h4 className="font-medium mb-2">Po ukonczeniu tego poziomu bedziesz umial:</h4>
               <ul className="space-y-1">
                 {level.learningOutcomes.map(outcome => (
                   <li key={outcome.id} className="flex items-start gap-2 text-sm">
                     <CheckCircle className="h-4 w-4 text-green-500 mt-0.5 flex-shrink-0" />
                     {outcome.description}
                   </li>
                 ))}
               </ul>
             </div>

             {/* Chapters */}
             <ChapterList
               chapters={level.chapters}
               progress={progress}
               courseId={courseId}
               levelId={level.id}
             />
           </CardContent>
         </CollapsibleContent>
       </Collapsible>
     </Card>
     ```

3. Utworz `src/components/curriculum/chapter-list.tsx`:
   - Client component
   - Props: chapters, progress, courseId, levelId
   - Wyswietl liste rozdzialow:
     ```tsx
     <div className="space-y-2">
       {chapters.map((chapter, index) => {
         const isCompleted = progress.completedChapters.includes(chapter.id);
         const isCurrent = progress.currentChapterId === chapter.id;

         return (
           <Link
             key={chapter.id}
             href={`/courses/${courseId}/${levelId}/${chapter.id}`}
             className={cn(
               "flex items-center justify-between p-3 rounded-lg border transition-colors",
               isCompleted && "bg-green-50 border-green-200 dark:bg-green-950/20 dark:border-green-800",
               isCurrent && "bg-primary/5 border-primary",
               !isCompleted && !isCurrent && "hover:bg-muted"
             )}
           >
             <div className="flex items-center gap-3">
               <span className="text-muted-foreground w-6">{index + 1}.</span>
               {isCompleted ? (
                 <CheckCircle className="h-5 w-5 text-green-500" />
               ) : isCurrent ? (
                 <Circle className="h-5 w-5 text-primary" />
               ) : (
                 <Circle className="h-5 w-5 text-muted-foreground" />
               )}
               <div>
                 <p className="font-medium">{chapter.title}</p>
                 <p className="text-sm text-muted-foreground">{chapter.description}</p>
               </div>
             </div>
             <span className="text-sm text-muted-foreground">
               {chapter.estimatedMinutes} min
             </span>
           </Link>
         );
       })}
     </div>
     ```

4. Utworz `src/components/curriculum/curriculum-toc.tsx`:
   - Client component (dla state expanded levels)
   - Props: levels, progress, courseId
   - State: expandedLevels (Set<string>)
   - Domyslnie rozwin aktualny poziom
   - Wyswietl LevelCard dla kazdego z 5 poziomow
  </action>
  <verify>
- `npm run build` - brak bledow
- `grep "learningOutcomes.map\|learningOutcomes?.map" src/components/curriculum/level-card.tsx` - renderuje outcomes
- `grep "chapters.map\|chapters?.map" src/components/curriculum/chapter-list.tsx` - renderuje rozdzialy
- `grep "Collapsible" src/components/curriculum/level-card.tsx` - uzywa collapsible
  </verify>
  <done>
CurriculumTOC: kontener z expandable state.
LevelCard: collapsible card z learning outcomes i chapters.
ChapterList: lista rozdzialow z progress indicators i linkami.
  </done>
</task>

</tasks>

<verification>
Po ukonczeniu obu taskow:
1. `npm run build` - brak bledow
2. Odwiedz /courses/[courseId] dla istniejacego kursu:
   - Widoczny tytul, opis, szacowany czas
   - Widoczny procent ukonczenia
   - 5 poziomow jako collapsible cards
   - Kazdy poziom ma learning outcomes
   - Kazdy poziom ma liste rozdzialow z progress
   - Klikniecie w rozdzial nawiguje do /courses/[courseId]/[levelId]/[chapterId]
</verification>

<success_criteria>
- [ ] Strona /courses/[courseId] wyswietla pelna strukture kursu
- [ ] Kazdy z 5 poziomow jest jako collapsible card
- [ ] Learning outcomes widoczne dla kazdego poziomu
- [ ] Rozdzialy maja progress indicators (completed/current/pending)
- [ ] Linki do rozdzialow dzialaja
- [ ] "Kontynuuj nauke" linkuje do aktualnego rozdzialu
- [ ] `npm run build` przechodzi bez bledow
</success_criteria>

<output>
After completion, create `.planning/phases/02-curriculum-generation/02-05-SUMMARY.md`
</output>
