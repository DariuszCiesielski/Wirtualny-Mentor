---
phase: 02-curriculum-generation
plan: 07
type: execute
wave: 4
depends_on: ["02-05"]
files_modified:
  - src/app/(dashboard)/courses/page.tsx
  - src/components/curriculum/course-card.tsx
  - src/components/layout/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Uzytkownik widzi liste wszystkich swoich kursow"
    - "Kazdy kurs pokazuje postep i ostatnia aktywnosc"
    - "Uzytkownik moze przelaczac sie miedzy kursami"
    - "Dashboard pozwala utworzyc nowy kurs"
  artifacts:
    - path: "src/app/(dashboard)/courses/page.tsx"
      provides: "Courses listing page"
      min_lines: 40
    - path: "src/components/curriculum/course-card.tsx"
      provides: "Course card with progress"
      contains: "progress"
  key_links:
    - from: "src/app/(dashboard)/courses/page.tsx"
      to: "src/lib/dal/courses.ts"
      via: "getUserCourses import"
      pattern: "getUserCourses"
---

<objective>
Multi-course dashboard - lista kursow uzytkownika.

Purpose: Uzytkownik moze miec wiele kursow rownoczesnie i przelaczac sie miedzy nimi. Dashboard pokazuje wszystkie kursy z ich postepem.
Output: Strona /courses z lista kursow, progress info i mozliwoscia dodania nowego.
</objective>

<execution_context>
@C:\Users\dariu\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dariu\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-curriculum-generation/02-01-SUMMARY.md
@.planning/phases/02-curriculum-generation/02-05-SUMMARY.md
@src/lib/dal/courses.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Courses listing page</name>
  <files>
    src/app/(dashboard)/courses/page.tsx
  </files>
  <action>
Utworz `src/app/(dashboard)/courses/page.tsx`:

```typescript
import { requireAuth } from '@/lib/dal/auth';
import { getUserCourses } from '@/lib/dal/courses';
import { CourseCard } from '@/components/curriculum/course-card';
import { Button } from '@/components/ui/button';
import Link from 'next/link';
import { Plus, BookOpen } from 'lucide-react';

export default async function CoursesPage() {
  const { user } = await requireAuth();
  const courses = await getUserCourses(user.id);

  return (
    <div className="container max-w-6xl py-8">
      <div className="flex justify-between items-center mb-8">
        <div>
          <h1 className="text-3xl font-bold">Moje kursy</h1>
          <p className="text-muted-foreground mt-1">
            Zarzadzaj swoimi kursami i sledz postepy
          </p>
        </div>
        <Button asChild>
          <Link href="/courses/new">
            <Plus className="h-4 w-4 mr-2" />
            Nowy kurs
          </Link>
        </Button>
      </div>

      {courses.length === 0 ? (
        <div className="text-center py-16 border-2 border-dashed rounded-lg">
          <BookOpen className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
          <h2 className="text-xl font-medium mb-2">Brak kursow</h2>
          <p className="text-muted-foreground mb-4">
            Rozpocznij nauke tworzac swoj pierwszy kurs
          </p>
          <Button asChild>
            <Link href="/courses/new">
              <Plus className="h-4 w-4 mr-2" />
              Utworz pierwszy kurs
            </Link>
          </Button>
        </div>
      ) : (
        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {courses.map(course => (
            <CourseCard key={course.id} course={course} />
          ))}
        </div>
      )}
    </div>
  );
}
```

UWAGA:
- getUserCourses zwraca kursy z progress info (completedChapters, lastActivityAt)
- Grid layout: 1 col mobile, 2 col tablet, 3 col desktop
- Empty state z CTA do utworzenia kursu
- Header z przyciskiem "Nowy kurs"
  </action>
  <verify>
- `npm run build` - brak bledow
- `grep "getUserCourses" src/app/(dashboard)/courses/page.tsx` - pobiera kursy
- `grep "CourseCard" src/app/(dashboard)/courses/page.tsx` - uzywa card component
  </verify>
  <done>
Strona /courses z:
- Header z tytulem i przyciskiem "Nowy kurs"
- Empty state dla uzytkownikow bez kursow
- Grid z CourseCard dla kazdego kursu
  </done>
</task>

<task type="auto">
  <name>Task 2: Course card component</name>
  <files>
    src/components/curriculum/course-card.tsx
    src/components/layout/sidebar.tsx
  </files>
  <action>
1. Utworz `src/components/curriculum/course-card.tsx`:

```typescript
'use client';

import Link from 'next/link';
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Clock, BookOpen, ArrowRight } from 'lucide-react';
import { formatDistanceToNow } from '@/lib/utils'; // helper do formatowania czasu

interface CourseWithProgress {
  id: string;
  title: string;
  description: string | null;
  totalEstimatedHours: number | null;
  status: 'draft' | 'generating' | 'active' | 'completed' | 'archived';
  createdAt: Date;
  progress: {
    completedChapters: string[];
    completedLevels: string[];
    lastActivityAt: Date | null;
    completedAt: Date | null;
  } | null;
  levelsCount: number;
  chaptersCount: number;
}

interface CourseCardProps {
  course: CourseWithProgress;
}

export function CourseCard({ course }: CourseCardProps) {
  const completedChapters = course.progress?.completedChapters.length || 0;
  const totalChapters = course.chaptersCount;
  const percentage = totalChapters > 0 ? Math.round((completedChapters / totalChapters) * 100) : 0;

  const statusBadge = {
    draft: { label: 'Szkic', variant: 'secondary' as const },
    generating: { label: 'Generowanie...', variant: 'outline' as const },
    active: { label: 'W trakcie', variant: 'default' as const },
    completed: { label: 'Ukonczony', variant: 'success' as const },
    archived: { label: 'Archiwum', variant: 'secondary' as const },
  }[course.status];

  const lastActivity = course.progress?.lastActivityAt
    ? formatDistanceToNow(new Date(course.progress.lastActivityAt))
    : null;

  return (
    <Card className="flex flex-col hover:shadow-md transition-shadow">
      <CardHeader className="flex-1">
        <div className="flex items-start justify-between gap-2">
          <CardTitle className="line-clamp-2">{course.title}</CardTitle>
          <Badge variant={statusBadge.variant}>{statusBadge.label}</Badge>
        </div>
        {course.description && (
          <p className="text-sm text-muted-foreground line-clamp-2 mt-2">
            {course.description}
          </p>
        )}
      </CardHeader>

      <CardContent>
        {/* Progress Bar */}
        {course.status === 'active' && (
          <div className="mb-4">
            <div className="flex justify-between text-xs text-muted-foreground mb-1">
              <span>{completedChapters} z {totalChapters} rozdzialow</span>
              <span>{percentage}%</span>
            </div>
            <div className="h-1.5 bg-muted rounded-full overflow-hidden">
              <div
                className="h-full bg-primary transition-all"
                style={{ width: `${percentage}%` }}
              />
            </div>
          </div>
        )}

        {/* Stats */}
        <div className="flex items-center gap-4 text-sm text-muted-foreground">
          {course.totalEstimatedHours && (
            <div className="flex items-center gap-1">
              <Clock className="h-4 w-4" />
              <span>{course.totalEstimatedHours}h</span>
            </div>
          )}
          <div className="flex items-center gap-1">
            <BookOpen className="h-4 w-4" />
            <span>{course.levelsCount} poziomow</span>
          </div>
        </div>

        {lastActivity && (
          <p className="text-xs text-muted-foreground mt-2">
            Ostatnia aktywnosc: {lastActivity}
          </p>
        )}
      </CardContent>

      <CardFooter className="pt-0">
        <Button asChild className="w-full">
          <Link href={`/courses/${course.id}`}>
            {course.status === 'active' ? 'Kontynuuj nauke' : 'Zobacz kurs'}
            <ArrowRight className="h-4 w-4 ml-2" />
          </Link>
        </Button>
      </CardFooter>
    </Card>
  );
}
```

2. Dodaj helper do formatowania czasu w `src/lib/utils.ts`:
```typescript
export function formatDistanceToNow(date: Date): string {
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMins / 60);
  const diffDays = Math.floor(diffHours / 24);

  if (diffMins < 1) return 'przed chwila';
  if (diffMins < 60) return `${diffMins} min temu`;
  if (diffHours < 24) return `${diffHours}h temu`;
  if (diffDays < 7) return `${diffDays} dni temu`;
  return date.toLocaleDateString('pl-PL');
}
```

3. Zaktualizuj dashboard /dashboard/page.tsx:
- Dodaj sekcje "Ostatnie kursy" z 3 najnowszymi kursami
- Link "Zobacz wszystkie" do /courses

4. Upewnij sie ze sidebar ma poprawny link do /courses (z planu 02-06)
  </action>
  <verify>
- `npm run build` - brak bledow
- `grep "progress" src/components/curriculum/course-card.tsx` - wyswietla progress
- `grep "formatDistanceToNow" src/lib/utils.ts` - helper istnieje
- `grep "/courses" src/components/layout/sidebar.tsx` - link w sidebar
  </verify>
  <done>
CourseCard z:
- Badge statusu (draft/generating/active/completed)
- Progress bar dla aktywnych kursow
- Szacowany czas i liczba poziomow
- Ostatnia aktywnosc (relative time)
- Przycisk "Kontynuuj nauke" / "Zobacz kurs"

Helper formatDistanceToNow dla polskich dat.
Dashboard z sekcja "Ostatnie kursy".
  </done>
</task>

</tasks>

<verification>
Po ukonczeniu obu taskow:
1. `npm run build` - brak bledow
2. Odwiedz /courses:
   - Lista kursow wyswietla sie w gridzie
   - Kazdy kurs pokazuje progress bar (jesli active)
   - Badge statusu widoczny
   - Klik na "Kontynuuj nauke" prowadzi do kursu
3. Empty state wyswietla sie gdy brak kursow
4. Sidebar ma aktywny link "Moje kursy"
5. Dashboard /dashboard pokazuje ostatnie kursy
</verification>

<success_criteria>
- [ ] Strona /courses wyswietla liste kursow w gridzie
- [ ] CourseCard pokazuje progress, status, czas
- [ ] Empty state zacheca do utworzenia kursu
- [ ] Dashboard ma sekcje "Ostatnie kursy"
- [ ] Nawigacja miedzy kursami dziala
- [ ] `npm run build` przechodzi bez bledow
</success_criteria>

<output>
After completion, create `.planning/phases/02-curriculum-generation/02-07-SUMMARY.md`
</output>
