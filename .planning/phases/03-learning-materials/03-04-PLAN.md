---
phase: 03-learning-materials
plan: 04
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - package.json
  - src/components/materials/content-renderer.tsx
  - src/components/materials/source-list.tsx
  - src/components/materials/tool-card.tsx
autonomous: true

must_haves:
  truths:
    - "Markdown content jest renderowany z syntax highlighting"
    - "Citations [1] sa zamieniane na linki do zrodel"
    - "Lista zrodel jest wyswietlana na koncu"
    - "Narzedzia wyswietlaja sie z linkami i instrukcjami"
  artifacts:
    - path: "src/components/materials/content-renderer.tsx"
      provides: "Markdown renderer with code highlighting"
      exports: ["ContentRenderer"]
    - path: "src/components/materials/source-list.tsx"
      provides: "Citation sources display"
      exports: ["SourceList"]
    - path: "src/components/materials/tool-card.tsx"
      provides: "Tool recommendation card"
      exports: ["ToolCard"]
  key_links:
    - from: "src/components/materials/content-renderer.tsx"
      to: "react-markdown"
      via: "npm dependency"
      pattern: "import.*ReactMarkdown.*from.*react-markdown"
    - from: "src/components/materials/content-renderer.tsx"
      to: "@/types/materials"
      via: "Source type"
      pattern: "import.*Source.*from.*types/materials"
---

<objective>
Stworz komponenty UI do wyswietlania wygenerowanych materialow edukacyjnych.

Purpose: ContentRenderer renderuje markdown z syntax highlighting i zamienia citations [n] na linki. SourceList wyswietla liste zrodel. ToolCard prezentuje rekomendowane narzedzia z linkami.

Output: React components dla materialow edukacyjnych
</objective>

<execution_context>
@C:\Users\dariu\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dariu\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-learning-materials/03-RESEARCH.md
@src/types/materials.ts
@src/components/ui/card.tsx
@src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Instalacja markdown dependencies</name>
  <files>package.json</files>
  <action>
Zainstaluj wymagane pakiety dla renderowania markdown:

```bash
npm install react-markdown remark-gfm rehype-highlight rehype-raw rehype-sanitize
```

Pakiety:
- react-markdown: Renderowanie markdown w React
- remark-gfm: GitHub Flavored Markdown (tabele, checkboxy, strikethrough)
- rehype-highlight: Syntax highlighting dla code blocks
- rehype-raw: Obsluga raw HTML w markdown (ostronie uzywac)
- rehype-sanitize: Sanityzacja HTML dla bezpieczenstwa (XSS protection)

WAZNE: Nie uzywaj highlight.js CSS - uzyj Tailwind prose classes dla styling.
  </action>
  <verify>
    - `npm ls react-markdown` pokazuje zainstalowana wersje
    - `npm ls rehype-highlight` pokazuje zainstalowana wersje
  </verify>
  <done>Markdown dependencies zainstalowane</done>
</task>

<task type="auto">
  <name>Task 2: ContentRenderer component</name>
  <files>src/components/materials/content-renderer.tsx</files>
  <action>
Stworz `src/components/materials/content-renderer.tsx`:

```typescript
'use client';

/**
 * Content Renderer Component
 *
 * Renders markdown content with:
 * - Syntax highlighting for code blocks
 * - Citation links [1] -> source URLs
 * - GFM support (tables, checkboxes, strikethrough)
 * - External link indicators
 * - Copy button for code blocks
 */

import { useState } from 'react';
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import rehypeHighlight from 'rehype-highlight';
import rehypeRaw from 'rehype-raw';
import rehypeSanitize from 'rehype-sanitize';
import { Copy, Check, ExternalLink } from 'lucide-react';
import { cn } from '@/lib/utils';
import { Button } from '@/components/ui/button';
import type { Source } from '@/types/materials';

// Import highlight.js theme (github-dark matches our dark mode)
import 'highlight.js/styles/github-dark.css';

interface ContentRendererProps {
  content: string;
  sources?: Source[];
  className?: string;
}

/**
 * Copy button for code blocks
 */
function CopyButton({ code }: { code: string }) {
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    await navigator.clipboard.writeText(code);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <Button
      variant="ghost"
      size="icon"
      className="absolute top-2 right-2 h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity"
      onClick={handleCopy}
    >
      {copied ? (
        <Check className="h-4 w-4 text-green-500" />
      ) : (
        <Copy className="h-4 w-4" />
      )}
    </Button>
  );
}

/**
 * Extract code text from pre children
 */
function extractCode(children: React.ReactNode): string {
  if (typeof children === 'string') return children;

  if (Array.isArray(children)) {
    return children.map(extractCode).join('');
  }

  if (children && typeof children === 'object' && 'props' in children) {
    return extractCode((children as React.ReactElement).props.children);
  }

  return '';
}

export function ContentRenderer({ content, sources = [], className }: ContentRendererProps) {
  // Replace citation markers [1] with markdown links to sources
  const contentWithLinks = content.replace(
    /\[(\d+)\]/g,
    (match, num) => {
      const index = parseInt(num, 10) - 1;
      const source = sources[index];
      if (source) {
        // Create inline link with title tooltip
        return `[${num}](${source.url} "${source.title}")`;
      }
      return match;
    }
  );

  return (
    <div className={cn('prose prose-zinc dark:prose-invert max-w-none', className)}>
      <ReactMarkdown
        remarkPlugins={[remarkGfm]}
        rehypePlugins={[
          rehypeRaw,
          rehypeSanitize,
          [rehypeHighlight, { detect: true, ignoreMissing: true }],
        ]}
        components={{
          // Custom code block with copy button
          pre({ children, className: preClassName, ...props }) {
            const code = extractCode(children);
            return (
              <div className="relative group not-prose">
                <pre
                  {...props}
                  className={cn(
                    'rounded-lg overflow-x-auto bg-zinc-900 p-4 text-sm',
                    preClassName
                  )}
                >
                  {children}
                </pre>
                <CopyButton code={code} />
              </div>
            );
          },

          // Inline code styling
          code({ className: codeClassName, children, ...props }) {
            // Check if it's inline code (no hljs class)
            const isInline = !codeClassName?.includes('hljs');
            if (isInline) {
              return (
                <code
                  {...props}
                  className="bg-zinc-100 dark:bg-zinc-800 px-1.5 py-0.5 rounded text-sm font-mono"
                >
                  {children}
                </code>
              );
            }
            return (
              <code {...props} className={codeClassName}>
                {children}
              </code>
            );
          },

          // Custom blockquote for tips/warnings
          blockquote({ children }) {
            return (
              <blockquote className="border-l-4 border-primary bg-muted/50 p-4 my-4 not-prose rounded-r-lg">
                <div className="prose prose-zinc dark:prose-invert prose-sm">
                  {children}
                </div>
              </blockquote>
            );
          },

          // External links open in new tab with indicator
          a({ href, children, ...props }) {
            const isExternal = href?.startsWith('http');
            const isCitation = /^\d+$/.test(String(children));

            return (
              <a
                href={href}
                target={isExternal ? '_blank' : undefined}
                rel={isExternal ? 'noopener noreferrer' : undefined}
                className={cn(
                  'text-primary hover:underline',
                  isCitation && 'text-xs align-super bg-muted px-1 rounded'
                )}
                {...props}
              >
                {children}
                {isExternal && !isCitation && (
                  <ExternalLink className="inline ml-1 h-3 w-3" />
                )}
              </a>
            );
          },

          // Table styling
          table({ children }) {
            return (
              <div className="overflow-x-auto my-4">
                <table className="min-w-full divide-y divide-border">
                  {children}
                </table>
              </div>
            );
          },

          // Table header
          th({ children }) {
            return (
              <th className="px-4 py-2 text-left text-sm font-semibold bg-muted">
                {children}
              </th>
            );
          },

          // Table cell
          td({ children }) {
            return (
              <td className="px-4 py-2 text-sm border-t">
                {children}
              </td>
            );
          },
        }}
      >
        {contentWithLinks}
      </ReactMarkdown>
    </div>
  );
}
```

WAZNE:
- Citations [n] zamieniane na linki z tooltip
- Copy button na code blocks
- ExternalLink icon dla linkow zewnetrznych
- rehype-sanitize dla XSS protection
- Tailwind prose classes dla typography
- highlight.js theme import dla syntax highlighting
  </action>
  <verify>
    - `npx tsc --noEmit` - brak bledow TypeScript
    - Eksportuje ContentRenderer
  </verify>
  <done>ContentRenderer gotowy</done>
</task>

<task type="auto">
  <name>Task 3: SourceList i ToolCard components</name>
  <files>src/components/materials/source-list.tsx, src/components/materials/tool-card.tsx</files>
  <action>
1. Stworz `src/components/materials/source-list.tsx`:

```typescript
'use client';

/**
 * Source List Component
 *
 * Displays citations/sources at the end of content section.
 * Shows source type badge and external link.
 */

import { ExternalLink } from 'lucide-react';
import { Badge } from '@/components/ui/badge';
import type { Source } from '@/types/materials';

interface SourceListProps {
  sources: Source[];
}

const typeLabels: Record<Source['type'], string> = {
  documentation: 'Dokumentacja',
  article: 'Artykul',
  video: 'Wideo',
  course: 'Kurs',
  official: 'Oficjalne',
};

export function SourceList({ sources }: SourceListProps) {
  if (!sources.length) return null;

  return (
    <div className="bg-muted/50 rounded-lg p-4 mt-8">
      <h3 className="font-semibold mb-3 text-sm uppercase tracking-wide text-muted-foreground">
        Zrodla
      </h3>
      <ol className="space-y-2 text-sm">
        {sources.map((source, index) => (
          <li key={source.id} className="flex items-start gap-2">
            <span className="text-muted-foreground font-mono text-xs mt-0.5">
              [{index + 1}]
            </span>
            <div className="flex-1">
              <a
                href={source.url}
                target="_blank"
                rel="noopener noreferrer"
                className="text-primary hover:underline inline-flex items-center gap-1"
              >
                {source.title}
                <ExternalLink className="h-3 w-3 flex-shrink-0" />
              </a>
              <Badge variant="outline" className="ml-2 text-xs">
                {typeLabels[source.type]}
              </Badge>
            </div>
          </li>
        ))}
      </ol>
    </div>
  );
}
```

2. Stworz `src/components/materials/tool-card.tsx`:

```typescript
'use client';

/**
 * Tool Card Component
 *
 * Displays a recommended tool with link, description,
 * and optional install command.
 */

import { ExternalLink, Terminal, Check, X } from 'lucide-react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import type { Tool } from '@/types/materials';

interface ToolCardProps {
  tool: Tool;
}

export function ToolCard({ tool }: ToolCardProps) {
  return (
    <Card className="h-full">
      <CardHeader className="pb-2">
        <div className="flex items-start justify-between">
          <CardTitle className="text-lg">{tool.name}</CardTitle>
          <Badge variant={tool.isFree ? 'default' : 'secondary'}>
            {tool.isFree ? (
              <><Check className="h-3 w-3 mr-1" /> Darmowe</>
            ) : (
              <><X className="h-3 w-3 mr-1" /> Platne</>
            )}
          </Badge>
        </div>
        <CardDescription>{tool.description}</CardDescription>
      </CardHeader>
      <CardContent className="space-y-3">
        {tool.installCommand && (
          <div className="bg-zinc-900 rounded-md p-3 font-mono text-sm flex items-center gap-2">
            <Terminal className="h-4 w-4 text-muted-foreground flex-shrink-0" />
            <code className="text-zinc-100 overflow-x-auto">
              {tool.installCommand}
            </code>
          </div>
        )}
        <Button asChild variant="outline" className="w-full">
          <a
            href={tool.url}
            target="_blank"
            rel="noopener noreferrer"
          >
            Przejdz do strony
            <ExternalLink className="ml-2 h-4 w-4" />
          </a>
        </Button>
      </CardContent>
    </Card>
  );
}
```

WAZNE:
- SourceList numeruje zrodla od [1]
- Badge z typem zrodla (Dokumentacja, Artykul, etc.)
- ToolCard pokazuje install command jesli dostepny
- Badge dla free/paid narzedzi
- External link opens in new tab
  </action>
  <verify>
    - `npx tsc --noEmit` - brak bledow TypeScript
    - Eksportuje SourceList i ToolCard
  </verify>
  <done>SourceList i ToolCard gotowe</done>
</task>

</tasks>

<verification>
1. `npm ls react-markdown rehype-highlight` - pakiety zainstalowane
2. `npx tsc --noEmit` przechodzi bez bledow
3. Komponenty w src/components/materials/ istnieja
4. Eksportuja: ContentRenderer, SourceList, ToolCard
</verification>

<success_criteria>
- [ ] react-markdown i rehype-* zainstalowane
- [ ] ContentRenderer renderuje markdown z syntax highlighting
- [ ] Citations [n] zamieniane na linki
- [ ] SourceList wyswietla numerowana liste zrodel
- [ ] ToolCard wyswietla narzedzie z install command
- [ ] Brak bledow TypeScript
</success_criteria>

<output>
After completion, create `.planning/phases/03-learning-materials/03-04-SUMMARY.md`
</output>
