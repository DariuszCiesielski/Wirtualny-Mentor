---
phase: 06-mentor-chatbot
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/ai/mentor/prompts.ts
  - src/lib/ai/mentor/tools.ts
autonomous: true

must_haves:
  truths:
    - "System prompt nakazuje stosowac metode sokratyczna"
    - "System prompt zawiera przyklady transformacji pytan"
    - "Tool searchNotes ma jasny opis kiedy go uzywac"
    - "Tool zwraca notatki z truncated content dla context window"
  artifacts:
    - path: "src/lib/ai/mentor/prompts.ts"
      provides: "MENTOR_SYSTEM_PROMPT constant"
      exports: ["MENTOR_SYSTEM_PROMPT"]
    - path: "src/lib/ai/mentor/tools.ts"
      provides: "searchNotes tool factory"
      exports: ["createSearchNotesTool"]
  key_links:
    - from: "src/lib/ai/mentor/tools.ts"
      to: "src/lib/dal/notes.ts"
      via: "import searchNotesSemantic"
      pattern: "searchNotesSemantic"
---

<objective>
Create mentor chatbot system prompt with Socratic method instructions and RAG tool definition.

Purpose: Define AI behavior for mentor role - Socratic questioning, coaching persona, and notes retrieval capability.
Output: prompts.ts with MENTOR_SYSTEM_PROMPT, tools.ts with createSearchNotesTool factory function.
</objective>

<execution_context>
@C:\Users\dariu\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dariu\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-mentor-chatbot/06-RESEARCH.md

# Existing patterns
@src/lib/ai/curriculum/prompts.ts
@src/lib/ai/materials/tools.ts
@src/lib/dal/notes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mentor system prompt</name>
  <files>src/lib/ai/mentor/prompts.ts</files>
  <action>
Create system prompt for Socratic mentor chatbot:

1. Create directory `src/lib/ai/mentor/` if not exists
2. Create `prompts.ts` with `MENTOR_SYSTEM_PROMPT` constant
3. Include these mandatory sections in the prompt:

**KLUCZOWA ZASADA: Metoda sokratyczna**
- NIGDY nie dawaj gotowych odpowiedzi
- ZAWSZE naprowadzaj pytaniami
- Rozbijaj problemy na mniejsze kroki
- Pomagaj dostrzec bledy przez pytania

**Przyklady transformacji** (few-shot):
- "Jak posortowac liste?" -> "Co juz wiesz o listach? Czy probowalas jakiejs metody?"
- "Moj kod nie dziala" -> "Co ten kod powinien robic? A co faktycznie robi?"
- "Nie rozumiem X" -> "Sprobujmy rozlozyc to na czesci - od czego chcesz zaczac?"

**Rola coacha**:
- Wspieraj emocjonalnie
- Normalizuj trudnosci
- Motywuj i doceniaj postepy
- Zachecaj do eksperymentow

**Dostep do notatek (tool searchNotes)**:
- Uzyj gdy pytanie moze dotyczyc wczesniejszej nauki
- Odwoluj sie do notatek uzytkownika
- Pomagaj laczyc nowa wiedze z poprzednia

**Poziom zaawansowania**:
- Mozesz odpowiadac na pytania wykraczajace poza aktualny poziom
- Zaznacz jesli temat jest zaawansowany i zaproponuj sciezke

**Jezyk**: ZAWSZE po polsku, jasny i przystepny

Pattern from research: See 06-RESEARCH.md "Complete System Prompt" section for full example.
  </action>
  <verify>
    - File exists at src/lib/ai/mentor/prompts.ts
    - Export MENTOR_SYSTEM_PROMPT is a string with "sokratyczna" and "NIGDY"
  </verify>
  <done>System prompt exported with Socratic method instructions, examples, and coach persona</done>
</task>

<task type="auto">
  <name>Task 2: Create searchNotes tool factory</name>
  <files>src/lib/ai/mentor/tools.ts</files>
  <action>
Create tool definition for RAG retrieval:

1. Create `tools.ts` in `src/lib/ai/mentor/`
2. Import `tool` from 'ai' and `z` from 'zod'
3. Import `searchNotesSemantic` from '@/lib/dal/notes'
4. Create factory function `createSearchNotesTool(context: ToolContext)`:

```typescript
interface ToolContext {
  userId: string;
  courseId: string;
}
```

5. Tool definition:
- **description**: Clear Polish description of when to use (when user asks about their notes, needs prior learning context)
- **inputSchema**: `z.object({ query: z.string().describe('Fraza do wyszukania semantycznego') })`
- **execute**: Calls searchNotesSemantic with context.userId, context.courseId, query
  - threshold: 0.5 (lower for better recall)
  - limit: 5
  - Truncate content to 500 chars per note (context window management)
  - Return `{ found: boolean, notes?: Array<{content, relevance}>, message?: string }`

Pattern: See 06-RESEARCH.md "Complete Tool Definition" for exact implementation.
  </action>
  <verify>
    - File exists at src/lib/ai/mentor/tools.ts
    - createSearchNotesTool is exported
    - Function uses searchNotesSemantic from DAL
    - Content is truncated to 500 chars
  </verify>
  <done>Tool factory function returns AI SDK tool with semantic search and content truncation</done>
</task>

</tasks>

<verification>
After all tasks:
1. TypeScript compiles: `npx tsc --noEmit`
2. Both files export correctly (imports work in test file)
3. Tool description mentions "notatki" or "notes"
4. System prompt contains "sokratyczna" and coaching language
</verification>

<success_criteria>
- MENTOR_SYSTEM_PROMPT constant exported from prompts.ts
- createSearchNotesTool function exported from tools.ts
- System prompt has Socratic method with DO/DON'T examples
- Tool integrates with existing searchNotesSemantic from DAL
</success_criteria>

<output>
After completion, create `.planning/phases/06-mentor-chatbot/06-01-SUMMARY.md`
</output>
